---
title: "Supercaps and the forces that drive them"
date: 2020-03-20T21:13:14-05:00
output: 
 html_document:
   theme: yeti
   toc: yes
   toc_float: yes

---

<style>

h1{
  font-size: 30px;
}
h2{
  font-size: 29px;
}
body{
  font-size: 15px;
  font-family: 'Open Sans', sans-serif;
}

p{
margin: 0 0 10.5px;
margin-top: 0px;
margin-right: 0px;
margin-bottom: 25px;
margin-left: 0px;
line-height: 26px;
}
</style>


```{r load_packages, include = FALSE}
library(tidyverse)
library(scales)
library(extrafont)
library(gganimate)
library(magick)
library(xts)
library(ggrepel)
library(gifski)
library(Cairo)
```

<br>

##Introduction

A breed of company has established itself, whose businesses are valued at such colossal amounts, that to call its members Supercaps would be more fitting than the Large- and Mega-cap labels traditionally used to describe firms with the biggest market capitalizations. The Supercap group overlaps with some of the stocks popularly referred to as FANG, though Netflix, at a relatively modest ~$150 billion market cap, does not make the cut. Big Tech, another oft-repeated tag, likely does include all of today's Supercaps, yet its use as an umbrella term for much of the tech industry has made it hard to know the extent of what can be considered Big Tech or not. 

The Supercaps are Google, Apple, Facebook, Amazon, and Microsoft (GAFAM), the top five largest publicly traded US companies, each with a market capitalization of over half a trillion dollars. Apple and Microsoft currently trade at valuations over \$1 trillion. The collective performance of the Supercap equities has been quite strong as of late, as has been the case for most of the last decade. Since only mid-2015, the total market cap of GAFAM has _increased_ by \$2.5 trillion, more than the current _size_ of the German, Italian, and Spanish stock markets combined.^[The [MSCI Germany](https://www.msci.com/documents/10199/d76361cb-d5a5-4185-97ce-ec5e3dd5bf2e), MSCI Italy, and MSCI Spain indices, which cover 85% of each nation's equity market, collectively account for just over $2 trillion in market cap as of November 2019.]

```{r mktcap, echo=FALSE, warning=FALSE, message = FALSE}

colors <- c('aqua' = "#45BCC9", 'green' = "#648C2E", 'deep blue' = "#00567D",
            'espresso' = "#310008", 'sand' = "#E1D1A7", 'orange' = "#F38B00",
            'red' = "#A51D31", 'dark grey' = "8E8279", 'border grey' = "#808080",
            'text' = "#222222")

cpal <- function(...) {
  cols <- c(...)
  if (is.null(cols))
    return(colors)
  colors[[cols]]
}

raw_dat <- read_csv("D:\\Documents\\R directory\\supercaps\\mktcap_timeseries.csv")

dat <- raw_dat %>% 
  as_tibble(rownames = FALSE) %>% 
  rename(date = X1) %>% 
  mutate(GAFAM = GOOG + AMZN + FB + AAPL + MSFT,
         SP500exGAFAM = SP500 - GAFAM,
         date = as.Date(date, "%m/%d/%Y")) %>%
  select(date, SP500, GAFAM, SP500exGAFAM)

df_ind <- dat %>%
  mutate(SP500 = (SP500 / dat$SP500[1]) * 100,
         GAFAM = (GAFAM / dat$GAFAM[1]) * 100,
         SP500exGAFAM = (SP500exGAFAM / dat$SP500exGAFAM[1]) * 100)

df4c <- df_ind %>% 
  select(date, SP500) %>% 
  set_names("date", "S&P 500") %>% 
  gather(key, value, -date)

df4c2 <- df_ind %>% 
  rename(date2 = date) %>% 
  select(date2, GAFAM, SP500exGAFAM) %>% 
  set_names("date2", "GAFAM", "S&P 500 ex GAFAM") %>% 
  gather(key, value, -date2)

## charts

start_date <- head(df4c$date,1)
end_date <- tail(df4c$date,1)
ctitle_1 <- "While the overall market is up since 2015..."
ctitle_2 <- "GAFAM has outperformed significantly"
unit_label <- "Market capitalization, 7/3/2015 = 100"
source_1 <- "@benbakkum."

fmt_dcmls <- function(decimals = 0) {
  function(x) as.character(round(x, decimals))
}

str_pad_custom <- function(labels) {
  new_labels <- stringr::str_pad(labels, 10, "right")
  return(new_labels)
}


chart1 <- ggplot(data = df4c, aes(x = date, y = value, color = key, linetype = key)) +
  geom_line() +
  geom_point(size = 2.5) +
  geom_text(data = df4c, aes(x = date, y = value, label = round(value, digits = 0)), nudge_x = 53,
            show.legend = FALSE, size = 4.5, family = "Open Sans") +
  scale_linetype_manual(values = c("solid")) +
  scale_color_manual(values = c("forest green")) +
  scale_x_date(limits = c(start_date, end_date + 15), expand = c(0,0)) +
  scale_y_continuous(labels = fmt_dcmls(0)) +
  theme(
    panel.background = element_rect(fill = "white"),
    panel.border = element_rect(fill = NA, color = cpal("border grey"), size = 0.3),
    plot.title = element_text(size = 21, color = "black", family = "Open Sans Light"),
    plot.subtitle = element_text(size = 14, color = cpal("text"), family = "Open Sans"),
    plot.caption = element_text(size = 12.5, color = cpal("text"), family = "Open Sans"),
    text = element_text(size = 15, color = cpal("text"), family = "Open Sans"),
    legend.text = element_text(size = 15, color = cpal("text"), family = "Open Sans"),
    axis.text.x = element_text(size = 14, color = cpal("text"), family = "Open Sans",
                               margin = unit(c(0.35, 0.25, 0.25, 0.25), "cm")),
    axis.text.y = element_text(size = 14, color = cpal("text"), family = "Open Sans",
                               margin = unit(c(0.25, 0.25, 0.25, 0.25), "cm")),
    axis.title.y = element_blank(),
    axis.title.x = element_blank(),
    axis.ticks.length = unit(-0.15, "cm"),
    axis.ticks = element_line(color = cpal("border grey"), size = 0.3),
    plot.margin = unit(c(0.3, 0.5, 0.3, 0.05), "cm"),
    legend.position = "bottom",
    legend.title = element_blank(),
    legend.key = element_blank(),
    legend.key.size = unit(0.37, "cm"),
    legend.background = element_blank(),
    legend.margin = margin(t = -0.5, unit = "cm")) +
  labs(title = ctitle_1, subtitle = unit_label,
       caption = paste("Data as of ", format(tail(df4c$date,1), "%b %Y"), ". ", source_1[1], sep = "")) +
  transition_reveal(date, keep_last = FALSE) +
  ease_aes('linear') +
  view_follow(fixed_x = TRUE)

anim1 <- animate(chart1, renderer = gifski_renderer(loop = T),
                 width = 575, height = 393, type = "cairo")


chart2 <- ggplot(data = df4c2, aes(x = date2, y = value, color = key, linetype = key)) +
  geom_line() +
  geom_point(size = 2.5) +
  geom_line(data = df4c, aes(x = date, y = value, color = key, linetype = key)) +
  geom_text(aes(x = date2, y = value, label = round(value, digits = 0)), nudge_x = 53,
            show.legend = FALSE, size = 4.5, family = "Open Sans") +
  scale_linetype_manual(values = c("solid", "solid", "dashed"), guide = "none") +
  scale_color_manual(values = c("dodger blue", "forest green", "orange"),
                     labels = str_pad_custom(c("GAFAM", "S&P 500", "S&P 500 ex GAFAM"))) +
  scale_x_date(limits = c(start_date, end_date + 15), expand = c(0,0)) +
  scale_y_continuous(labels = fmt_dcmls(0)) +
  theme(
    panel.background = element_rect(fill = "white"),
    panel.border = element_rect(fill = NA, color = cpal("border grey"), size = 0.3),
    plot.title = element_text(size = 21, color = "black", family = "Open Sans Light"),
    plot.subtitle = element_text(size = 14, color = cpal("text"), family = "Open Sans"),
    plot.caption = element_text(size = 12.5, color = cpal("text"), family = "Open Sans"),
    text = element_text(size = 15, color = cpal("text"), family = "Open Sans"),
    legend.text = element_text(size = 15, color = cpal("text"), family = "Open Sans"),
    axis.text.x = element_text(size = 14, color = cpal("text"), family = "Open Sans",
                               margin = unit(c(0.35, 0.25, 0.25, 0.25), "cm")),
    axis.text.y = element_text(size = 14, color = cpal("text"), family = "Open Sans",
                               margin = unit(c(0.25, 0.25, 0.25, 0.25), "cm")),
    axis.title.y = element_blank(),
    axis.title.x = element_blank(),
    axis.ticks.length = unit(-0.15, "cm"),
    axis.ticks = element_line(color = cpal("border grey"), size = 0.3),
    plot.margin = unit(c(0.3, 0.5, 0.3, 0.05), "cm"),
    legend.position = "bottom",
    legend.title = element_blank(),
    legend.key = element_blank(),
    legend.key.size = unit(0.37, "cm"),
    legend.background = element_blank(),
    legend.margin = margin(t = -0.5, unit = "cm")) +
  labs(title = ctitle_2, subtitle = unit_label,
       caption = paste("Data as of ", format(tail(df4c$date,1), "%b %Y"), ". ", source_1[1], sep = "")) +
  transition_reveal(date2, keep_last = FALSE) +
  ease_aes('linear') +
  view_follow(fixed_x = TRUE)

anim2 <- animate(chart2, renderer = gifski_renderer(loop = T),
                 width = 575, height = 393, type = "cairo")

gif1 <- image_read(anim1)
gif2 <- image_read(anim2)

gif_final <- c(gif1, gif2, rep(gif2[100], 50))
gif_final
```

## The rise of platforms












